var e,t,r,n,o,a,i,l,u,s,f,d,c,v,m,h,g,y,S,T,p,C;t={},r={},null==(n=(e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire7b01)&&((n=function(e){if(e in t)return t[e].exports;if(e in r){var n=r[e];delete r[e];var o={id:e,exports:{}};return t[e]=o,n.call(o.exports,o,o.exports),o.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){r[e]=t},e.parcelRequire7b01=n),n.register,i=n("lRvfw"),o=n("8xYaD"),a=n("bs6f0"),i=n("lRvfw"),l=new(function(){var e;function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.default.INITIAL_STATE;(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,t),this.gameContext={state:e,score:0,status:i.default.STATUS.idle,movePossible:!0,moves:0}}return e=[{key:"moveLeft",value:function(){return this.move(i.default.DIRECTION.left)}},{key:"moveRight",value:function(){return this.move(i.default.DIRECTION.right)}},{key:"moveUp",value:function(){return this.move(i.default.DIRECTION.up)}},{key:"moveDown",value:function(){return this.move(i.default.DIRECTION.down)}},{key:"getScore",value:function(){return this.gameContext.score}},{key:"getState",value:function(){return Array.from(this.gameContext.state).map(function(e){return Array.from(e)})}},{key:"getStatus",value:function(){return this.getGameContext().status}},{key:"start",value:function(){this.updateGameContext({status:i.default.STATUS.playing}),this.addRandomCellValue(),this.addRandomCellValue()}},{key:"restart",value:function(){this.updateGameContext({score:0,state:i.default.INITIAL_STATE,status:i.default.STATUS.playing}),this.addRandomCellValue(),this.addRandomCellValue()}},{key:"win",value:function(){this.updateGameContext({status:i.default.STATUS.win})}},{key:"lose",value:function(){this.updateGameContext({status:i.default.STATUS.lose})}},{key:"getMoves",value:function(){return this.getGameContext().moves}},{key:"getGameContext",value:function(){return this.gameContext}},{key:"canMoveOrMergeCells",value:function(e,t){return 0===e&&0!==t||(0!==e||0!==t)&&e===t}},{key:"stateHasZeroes",value:function(){return this.getState().some(function(e){return e.some(function(e){return 0===e})})}},{key:"mergeIsPossible",value:function(){for(var e=this.getState(),t=0;t<e.length;t++)for(var r=0;r<e[t].length;r++){var n=e[t][r],o=e[t][r+1];if(o&&n===o)return!0;if(t!==e.length-1){var a=e[t+1][r];if(a&&n===a)return!0}}return!1}},{key:"checkIfLost",value:function(){return!this.stateHasZeroes()&&!this.mergeIsPossible()}},{key:"checkAvailableMovesOnSingleLine",value:function(e){for(var t=0;t<e.length;t++)for(var r=0;r<e[t].length-1;r++){var n=e[t][r],o=e[t][r+1];if(this.canMoveOrMergeCells(n,o))return!0}return!1}},{key:"updateGameContext",value:function(e){var t=this;Object.entries(e).forEach(function(e){var r=e[0],n=e[1];t.gameContext[r]=n})}},{key:"reverseStateByAxis",value:function(e){return Array.from(e.map(function(e){return Array.from(e).reverse()}))}},{key:"transformStatePerDirection",value:function(e,t){switch(t){case i.default.DIRECTION.left:return e;case i.default.DIRECTION.right:return this.reverseStateByAxis(e);case i.default.DIRECTION.up:return this.transposeState(e,!1);case i.default.DIRECTION.down:return this.transposeState(e,!0)}}},{key:"transposeState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Array.from(e).map(function(e){return Array.from(e)});return e.forEach(function(e,t){e.forEach(function(e,n){r[n][t]=e})}),t?r.reverse().map(function(e){return e.reverse()}):r}},{key:"removeZeroes",value:function(e){return Array.from(e).map(function(e){return Array.from(e).filter(function(e){return 0!==e})})}},{key:"fillWithZeroes",value:function(e){return Array.from(e).map(function(e){if(!(e.length<i.default.FIELD_SIZE))return Array.from(e);var t=Array.from(e);return t.length=i.default.FIELD_SIZE,t.fill(0,e.length,i.default.FIELD_SIZE)})}},{key:"moveAndMergeTiles",value:function(e){for(var t=Array.from(e),r=0,n=0;n<e.length;n++)for(var o=0;o<e[n].length-1;o++){var a=e[n][o],l=e[n][o+1];if(0!==a&&a===l){var u=2*a;u===i.default.WIN_VALUE&&this.updateGameContext({status:i.default.STATUS.win}),r+=u,t[n][o]=u,t[n][o+1]=0}}return{score:r,stateWithMergedTiles:this.removeZeroes(t)}}},{key:"selectMoveFunction",value:function(e){return({left:this.moveLeft.bind(this),right:this.moveRight.bind(this),up:this.moveUp.bind(this),down:this.moveDown.bind(this)})[e]}},{key:"move",value:function(e){var t=this.transformStatePerDirection(this.getState(),e);if(this.updateGameContext({movePossible:this.checkAvailableMovesOnSingleLine(t)}),!this.getGameContext().movePossible)return!1;var r=this.removeZeroes(t),n=this.moveAndMergeTiles(r),o=n.score,a=n.stateWithMergedTiles,i=this.fillWithZeroes(a),l=this.transformStatePerDirection(i,e);return this.updateGameContext({score:this.getScore()+o,state:l,moves:this.getGameContext().moves+=1}),!0}},{key:"isTimeForFourTile",value:function(){return Math.random()<i.default.PROBABILITY_FOR_FOUR}},{key:"randomlyChangeNumberWithProbability",value:function(e,t){var r=Math.random();return r<t?r:e}},{key:"addRandomCellValue",value:function(){for(var e=this.getState(),t=Array.from(e).map(function(e){return Array.from(e)}),r=1,n=-1,o=-1,a=-1,i=0;i<e.length;i++)for(var l=0;l<e[i].length;l++)if(0===e[i][l]){var u=this.randomlyChangeNumberWithProbability(a,1/r);u!==a&&(a=u,n=i,o=l),r++}if(-1===n||-1===o||void 0===t[n][o])return{failedToAdd:!0};var s=this.isTimeForFourTile()?4:2;return 0===t[n][o]?(t[n][o]=s,this.updateGameContext({state:t}),{failedToAdd:!1,row:n,col:o,value:s}):{failedToAdd:!0}}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,e),t}()),u=document.querySelector(".game-field"),s=document.querySelector(".game-score"),f=function(e){var t=e.classList,r=!0,n=!1,o=void 0;try{for(var a,i=t[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var l=a.value;"field-cell"!==l&&e.classList.remove(l)}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}},d=function(){for(var e=l.getState(),t=u.rows,r=0;r<e.length;r++)for(var n=t[r].cells,o=e[r],a=0;a<n.length;a++){var i=o[a],d=n[a];f(d),0!==i?(d.innerHTML=i,d.classList.add("field-cell--"+i)):d.innerHTML=""}s.innerHTML=l.getScore()},c=function(e){var t=e.failedToAdd,r=e.row,n=e.col,o=e.value;if(!t){var a=u.rows[r].cells[n];a&&(a.innerHTML=o,a.classList.add("field-cell--"+o))}},v=document.querySelector(".start"),m=document.querySelector(".restart"),h=function(){(0,a.default).switchButtons(".restart"),(0,a.default).makeMessageVisible(".message-restart")},g=function(e){e===i.default.STATUS.win&&(0,a.default).makeMessageVisible(".message-win"),e===i.default.STATUS.lose&&(0,a.default).makeMessageVisible(".message-lose"),e!==i.default.STATUS.playing&&(0,a.default).defocusField(),C()},y=function(e){l.getStatus()!==i.default.STATUS.win&&l.getStatus()!==i.default.STATUS.lose&&new Promise(function(t,r){l.checkIfLost()&&r(Error(i.default.STATUS.lose)),l.selectMoveFunction(e)()?t("Moved"):r(Error("Move failed"))}).then(function(e){if(console.log(e),d(),1===l.getMoves()&&h(),l.getStatus()===i.default.STATUS.win){g(i.default.STATUS.win);return}setTimeout(function(){return c(l.addRandomCellValue())},300)}).catch(function(e){console.log({err:e}),e.message===i.default.STATUS.lose&&g(i.default.STATUS.lose),"Move failed"===e.message&&console.log(e.message)})},S=function(e){var t=e.key;t&&(0,o.keyController).arrowKeys.hasOwnProperty(t)&&y((0,o.keyController).identifyArrowKeyDirection(t))},T=function(e){y((0,o.swipeController).handleTouchEnd(e))},p=function(){document.addEventListener("keydown",S),u.addEventListener("touchstart",(0,o.swipeController).handleTouchStart.bind(o.swipeController)),u.addEventListener("touchend",T),u.addEventListener("touchmove",(0,o.swipeController).preventScrollOnSwipe.bind(o.swipeController))},C=function(){document.removeEventListener("keydown",S),u.removeEventListener("touchstart",(0,o.swipeController).handleTouchStart.bind(o.swipeController)),u.removeEventListener("touchend",T),u.removeEventListener("touchmove",(0,o.swipeController).preventScrollOnSwipe.bind(o.swipeController))},v.addEventListener("click",function(){l.getStatus()!==i.default.STATUS.playing&&(p(),l.start(),(0,a.default).focusField(),d())}),m.addEventListener("click",function(){C(),p(),(0,a.default).makeMessageVisible(".message-restart"),l.restart(),d(),(0,a.default).focusField()});
//# sourceMappingURL=index.e5fe1dec.js.map
